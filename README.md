# TrailPrint3D - 3D打印步道地图

[![Version](https://img.shields.io/badge/version-2.23-blue.svg)](https://github.com/xuqi2024/TrailPrint3D)
[![Blender](https://img.shields.io/badge/Blender-4.5%2B-orange.svg)](https://www.blender.org/)
[![License](https://img.shields.io/badge/license-CC%20BY--NC%204.0-green.svg)](https://creativecommons.org/licenses/by-nc/4.0/)

## 📖 文档

### 新手入门
- 📦 [安装指南](./安装指南.md) - 详细的安装步骤和配置说明
- 🚀 [快速参考](./快速参考.md) - 快速查询手册和参数速查表
- 📚 [使用指南](./使用指南.md) - 完整的中文使用教程
- 🚩 [旗帜标记快速指南](./快速使用指南_旗帜标记.md) - 5分钟上手旗帜功能

### 功能文档
- 🚩 [旗帜标记功能说明](./旗帜标记功能说明.md) - 详细的功能介绍和使用场景
- 📋 [更新日志](./更新日志.md) - 版本历史和功能更新

### 开发者资源
- � [技术实现文档](./技术实现文档_旗帜标记.md) - 代码结构和算法详解
- 📝 [代码修改总结](./代码修改总结.md) - v2.23 详细修改记录
- 🔧 [优化报告](./优化报告.md) - 详细的优化说明和技术细节

## 🏔️ 概述

TrailPrint3D 是一个 Blender 插件，可以将您喜爱的 GPS 路线转换为精美的 3D 打印艺术品。该插件支持 GPX 和 IGC 文件格式，使用真实的高程数据创建可定制的地形地图。

**最新版本 v2.23 新特性：**
- ✨ 完整的中文界面
- 🔧 自动修复网格异常点
- 🎨 单色模式默认启用
- 📏 底座下凹默认 2mm
- 🚀 分辨率默认提升至 8
- 🚩 **新功能：旗帜标记** - 在地形最低点和最高点自动添加起点/终点标记

### 主要特性

- 🗺️ **多种地图形状**：六边形、正方形、圆形等多种底座形状
- 🏔️ **真实地形数据**：集成 OpenTopoData、Open-Elevation 和 Terrain-Tiles API
- 📊 **路线统计**：自动计算距离、海拔增益和时长
- 🎨 **可定制外观**：调整大小、分辨率、路径粗细和海拔缩放
- 📝 **文字集成**：在地图上添加路线名称和统计数据
- 🚩 **旗帜标记**：在最低和最高海拔点自动添加视觉标记（v2.23新增）
- 🔧 **后期处理工具**：磁铁孔、燕尾榫、山地着色等功能
- 💧 **元素叠加**：包含水体、森林和城市边界（实验性功能）
- 🧩 **批量生成**：支持从文件夹导入多个 GPX 文件
- 📦 **直接导出**：一键导出为 STL/OBJ 格式用于 3D 打印

## 🚀 快速开始

### 系统要求

- Blender 4.5.2 或更高版本
- Python 3.x（Blender 内置）
- 互联网连接（用于获取高程数据）

### 安装步骤

1. **下载插件**
   ```
   git clone https://github.com/xuqi2024/TrailPrint3D.git
   ```

2. **在 Blender 中安装**
   - 打开 Blender
   - 编辑 → 偏好设置 → 插件
   - 点击"安装"按钮
   - 选择 `TrailPrint3D.py` 文件
   - 启用"TrailPrint3D"插件

3. **开始使用**
   - 在 3D 视图右侧面板找到"TrailPrint3D"标签
   - 选择您的 GPX/IGC 文件
   - 配置设置并点击"Generate"

## 📖 使用指南

### 基础工作流程

1. **选择文件**：点击"文件路径"浏览按钮选择您的 GPX 或 IGC 文件
2. **配置设置**：
   - 选择地图形状（六边形、正方形、圆形等）
   - 设置对象大小（单位：毫米）
   - 调整分辨率（推荐 6-8）
   - 设置海拔缩放和路径粗细
3. **生成地图**：点击"Generate"按钮
4. **导出文件**：选择导出路径并导出为 STL/OBJ 格式

### 高级功能

#### 比例模式
- **地图比例**：基于地图大小设置比例
- **坐标**：通过两个坐标点计算比例
- **全局比例**：基于全球比例（墨卡托投影）

#### API 选项
- **OpenTopoData**：较慢但更准确的高程数据
- **Open-Elevation**：更快但某些区域质量较低
- **Terrain-Tiles**：目前最快的数据集

#### 旗帜标记（v2.23 新增）
- **自动识别极值点**：智能查找地形的最低和最高海拔点
- **双色标记系统**：
  - 绿色起点旗帜 → 标记最低海拔点
  - 红色终点旗帜 → 标记最高海拔点
- **可调参数**：
  - 旗帜高度：1-30mm（推荐5mm）
  - 旗面宽度：0.5-10mm（推荐3mm）
- **独立STL导出**：旗帜作为单独文件导出，便于多色打印
- **详细文档**：查看 [旗帜标记功能说明](./旗帜标记功能说明.md)

#### 后期处理
- **重新缩放海拔**：调整已生成对象的 Z 轴比例
- **加厚地形**：使地图增加指定厚度
- **磁铁孔**：添加嵌入式磁铁孔
- **燕尾榫**：添加拼接切口
- **山地着色**：根据海拔高度着色山地
- **等高线**：生成地形等高线

## 📁 项目结构

```
TrailPrint3D/
├── TrailPrint3D.py          # 主插件文件
├── README.md                # 项目文档
└── .git/                    # Git 版本控制
```

## 🛠️ 依赖项

### Python 库（Blender 内置）
- `bpy` - Blender Python API
- `xml.etree.ElementTree` - GPX 文件解析
- `requests` - API 请求
- `bmesh` - 网格编辑
- `mathutils` - 数学工具

### 外部 API
- OpenTopoData API（每日 1000 次请求限制）
- Open-Elevation API（每月 1000 次请求限制）
- Terrain-Tiles（AWS 公共数据集）
- OpenStreetMap（水体、森林和城市数据）

## 📊 支持的文件格式

- **GPX 1.0 和 1.1**：标准 GPS 交换格式
- **IGC**：滑翔伞和航空运动记录格式

## 🎨 自定义选项

### 形状选项
- 六边形
- 正方形
- 圆形
- 六边形（内嵌文字）
- 六边形（外部文字）
- 六边形（正面文字）

### 文本选项
- 自定义字体支持
- 可调文本大小
- 路线统计覆盖
- 旋转和位置控制

### 材质系统
自动创建材质：
- BASE（绿色）- 基础地形
- MOUNTAIN（灰色）- 高海拔区域
- WATER（蓝色）- 水体
- FOREST（深绿色）- 森林区域
- TRAIL（红色）- 路径
- CITY（黄色）- 城市边界

## 🧪 测试数据

建议使用提供的示例 GPX 文件测试插件功能。

## 🌐 相关项目

- [Elevon](https://github.com/xuqi2024/Elevon) - 配套的 Web 系统，带有 GPX 上传和 3D 预览功能

## 📝 许可证

本作品采用 Creative Commons Attribution-NonCommercial 4.0 International License 许可。
查看许可证：https://creativecommons.org/licenses/by-nc/4.0/

## 🙏 致谢

### 数据来源
- 高程数据由 Mapzen Terrain Tiles 项目提供
- © Mapzen. 数据托管在 AWS 公共数据集计划中
- OpenTopoData 的高程数据，使用 SRTM 和其他数据集
- Open-Elevation 的高程数据，基于 NASA 的航天飞机雷达地形测绘任务（SRTM）数据
- 水体数据 © OpenStreetMap 贡献者
- Mapzen 的地形数据，基于 © OpenStreetMap 贡献者、NASA SRTM 和 USGS 的数据

### 地图数据
- 地图数据 © OpenStreetMap 贡献者

## 👤 作者

- **EmGi** - 插件开发
- **版本**：2.22

## 🤝 支持

- 💖 [在 Patreon 上支持](https://patreon.com/EmGi3D)
- 💬 [加入 Discord 社区](https://discord.gg/C67H9EJFbz)

## 📅 版本历史

- **v2.23** - 当前版本（2024）
  - 🚩 **新功能：旗帜标记系统**
    - 自动在地形最低点和最高点添加起点/终点旗帜
    - 绿色起点旗帜，红色终点旗帜
    - 可调节旗帜高度（1-30mm）和旗面宽度（0.5-10mm）
    - 独立STL文件导出，支持多色打印
  - 📝 **完整文档系统**
    - 新增旗帜功能说明文档
    - 快速使用指南
    - 技术实现文档
    - 代码修改总结
  - 🔧 **代码优化**
    - 新增 `create_flag()` 函数（152行）
    - 新增 `find_elevation_extremes()` 函数（44行）
    - 完善的错误处理和中文注释
  - ✨ **界面改进**
    - 在高级选项中添加旗帜设置面板
    - 折叠式参数显示
    - 实时参数调整

- **v2.22** - 代码优化和本地化
  - 改进的 API 集成
  - 增强的缓存系统
  - 新的后期处理工具
  - Bug 修复和性能优化
  - 完整中文界面
  - 本地字体查找系统

## 🔧 故障排除

### 常见问题

1. **网格出现随机孔洞**
   - 禁用缓存选项
   - 减小缓存大小

2. **API 请求限制**
   - OpenTopoData：每天 1000 次请求
   - Open-Elevation：每月 1000 次请求
   - 考虑使用 Terrain-Tiles 以获得更快的速度

3. **生成速度慢**
   - 降低分辨率设置
   - 使用 Terrain-Tiles API
   - 启用缓存

4. **导出失败**
   - 确保导出路径有效
   - 检查磁盘空间
   - 验证对象是否为网格类型

## 🚀 未来计划

- [ ] Web 界面集成
- [ ] 实时 3D 预览
- [ ] 更多地图形状
- [ ] 改进的 OSM 数据集成
- [ ] 批量处理优化
- [ ] 自动分块系统
- [ ] 云端渲染支持

